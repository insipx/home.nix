#!/usr/bin/env bash
# ~/bin/build-session

INSTANCE_ID="i-xxxxx"

case "$1" in
  start)
    echo "Starting build server..."
    aws ec2 start-instances --instance-ids $INSTANCE_ID
    aws ec2 wait instance-running --instance-ids $INSTANCE_ID

    # Get the IP (if not using elastic IP)
    IP=$(aws ec2 describe-instances --instance-ids $INSTANCE_ID \
      --query 'Reservations[0].Instances[0].PublicIpAddress' --output text)

    echo "Builder ready at $IP"
    echo "Update your nix.conf if IP changed"
    ;;

  stop)
    echo "Stopping build server..."
    aws ec2 stop-instances --instance-ids $INSTANCE_ID
    ;;

  status)
    aws ec2 describe-instances --instance-ids $INSTANCE_ID \
      --query 'Reservations[0].Instances[0].State.Name' --output text
    ;;
esac
